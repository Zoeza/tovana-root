{% extends "en-us/manager/base.html" %}
{% load static %}

<!-- title -->
{% block title %}
<title>
    TOVANA HEALTH manager | questionnaire
</title>
{% endblock %}

<!-- header -->
{% block page_header %}
<div class="row align-items-end">
  <div class="col-sm mb-2 mb-sm-0">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb breadcrumb-no-gutter">
        <li class="breadcrumb-item"><a class="breadcrumb-link" href="{% url 'home-manager' 'main' %}">Home</a></li>
        <li class="breadcrumb-item"><a class="breadcrumb-link" href="{% url 'questionnaire-manager' 'main' %}">Questions</a></li>
        <li class="breadcrumb-item active" aria-current="page">Selected Question</li>
      </ol>
    </nav>

    <h1 class="page-header-title">{{ selected_question.title|title }}</h1>
  </div>
  <div class="col-sm-auto">
    {% if not selected_question.type == 'single' %}
    <!-- create new answer choice button -->
    <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#create_new_answer_choice">
      Create New Answer Choice
    </button>
    <!-- end create new answer choice button -->

    <!-- create new answer choice modal -->
    <div id="create_new_answer_choice" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <!-- Header -->
        <div class="modal-close">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <!-- End Header -->

        <!-- Body -->
        <div class="modal-body">
          <div>
            <div class="text-center mb-7">
              <h2>{{ selected_question.title|title }}</h2>
            </div>

            <form action="{% url 'questionnaire-manager' 'create_new_answer' %}" class="js-validate need-validate" novalidate method="post">
              {% csrf_token %}
              <input type="hidden" name="question_token" value="{{ selected_question.token }}">

              <div class="col-sm text-start mb-4">
                <!-- answer -->
                <div class="input-group mb-4">
                  <input type="text" class="form-control" name="answer_content" placeholder="Yes ,No ,..." required>
                  <span class="invalid-feedback text-start">This field is required.</span>
                </div>
                <!-- end answer -->
              </div>
              <!-- submit -->
              <div class="text-center mb-2">

              </div>
              <div class="d-grid mb-4">
                <button type="submit" class="btn btn-primary form-control-lg">Confirm</button>
              </div>
              <!-- end submit -->
            </form>
          </div>
        </div>
        <!-- End Body -->
        </div>
      </div>
    </div>
    <!-- end create new answer choice modal -->
    {% endif %}
  </div>
</div>
{% endblock %}

<!-- table content -->
{% block table %}
{% if not selected_question.type == 'single' %}
<div class="row">
  <div class="col mb-3 mb-lg-0">
    <div class="card">
      <!-- Header -->
      <div class="card-header card-header-content-md-between">
        <div class="mb-2 mb-md-0">
          {{ selected_question.content|capfirst }}
        </div>
      </div>
      <!-- End Header -->

      <!-- Table -->
      <div class="table-responsive datatable-custom">
        <table class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table">
          <thead class="thead-light">
          <tr>
            <th></th>
            <th></th>
            <th></th>
          </tr>
          </thead>

          <tbody>
          {% for answer in selected_question.answer.all %}

          <!-- Table Forms -->
          <form action="{% url 'questionnaire-manager' 'delete_choice' %}" id="delete_choice_form_{{ choice.id }}" method="post">
            {% csrf_token %}
            <input type="hidden" name="choice_id" value="{{ choice.id }}">
            <input type="hidden" name="questionnaire_id" value="{{ selected_questionnaire.id }}">
          </form>
          <!-- End Table Forms -->

          <!-- Table Actions -->
          <tr>
            <td>
              <div class="ms-3">
                <span class="d-block h5 text-inherit mb-0">{{ answer.content|capfirst }}</span>
              </div>
            </td>

            <td>
              <div class="ms-3">
                {% if answer.next_question_token == 'stop' %}
                <span class="d-block fs-5 text-body">No next question</span>
                {% else %}
                <span class="d-block fs-5 text-body">{{ answer.next_question_content|capfirst }}</span>
                {% endif %}
              </div>
            </td>

            <td class="text-end">
              {% if answer.next_question_token == 'stop' %}
              <a type="button" class="text-body me-3" data-bs-toggle="modal" data-bs-target="#link_a_question_{{ answer.id }}">
                <i class="fa fa-paperclip fa-xl" data-bs-toggle="tooltip" data-bs-placement="top" title="Link a question"></i>
              </a>
              {% else %}
              <a href="{% url 'questionnaire-manager' 'selected_question_main' %}?question_token={{ answer.next_question_token }}&questions_page={{ questions_page }}" class="text-body me-3" >
                <i class="fa fa-arrow-pointer fa-xl" data-bs-toggle="tooltip" data-bs-placement="top" title="Select"></i>
              </a>
              {% endif %}

              <a type="button" class="btn btn-link text-body link-dark" data-bs-toggle="modal" data-bs-target="#edit_modal_{{ answer.id }}">
                <i class="fa fa-pen-to-square fa-xl" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit"></i>
              </a>

              <a type="button" class="btn btn-link text-body link-dark" data-bs-toggle="modal" data-bs-target="#delete_modal_{{ answer.id }}">
                <i class="fa fa-trash fa-xl" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete"></i>
              </a>
            </td>
          </tr>
          <!-- End Table Actions -->
          {% endfor %}
          </tbody>
        </table>
      </div>
      <!-- End Table -->


      {% for answer in selected_question.answer.all %}
      <!-- Next Question Modal -->
      <div id="link_a_question_{{ answer.id }}" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
              <!-- title -->
              <div class="text-center mb-7">
                <h2>Add Next Question</h2>
              </div>
              <form action="{% url 'questionnaire-manager' 'create_next_question' %}" class="js-validate need-validate" novalidate method="post">
                {% csrf_token %}
                <input type="hidden" name="question_token" value="{{ selected_question.token }}">
                <input type="hidden" name="answer_id" value="{{ answer.id }}">
                <!-- content -->
                <div class="input-group mb-4">
                  <span class="input-group-text" style="width: 20%;">Question</span>
                  <input type="text" class="form-control" name="content" placeholder="How much? (number or packs/cigarette per day)" required>
                  <span class="invalid-feedback text-start">This field is required.</span>
                </div>
                <!-- end content -->

                <!-- type -->
                <div class="mb-6">
                  <div class="input-group input-group-hover-light">
                    <div class="input-group-prepend input-group-text" style="width: 20%;">
                      Type
                    </div>
                    <select class="form-select text-center" name="type">
                      <option value="single">Single</option>
                      <option value="choice">Choice</option>
                      <option value="multiple">Multiple</option>
                    </select>
                  </div>
                </div>
                <!-- end type -->

                <div class="d-grid mb-4">
                  <button type="submit" class="btn btn-primary form-control-lg">Confirm</button>
                </div>
                <!-- end submit -->
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- End Next Question Modal -->

      <!-- Edit Choice Modal -->
      <div id="edit_modal_{{ choice.id }}" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
              <!-- title -->
              <div class="text-center mb-7">
                <h2>Edit Choice</h2>
              </div>
              <!-- end title -->

              <form action="{% url 'questionnaire-manager' 'edit_choice' %}" class="js-validate need-validate" novalidate method="post">
                {% csrf_token %}
                <input type="hidden" name="choice_id" value="{{ choice.id }}">
                <input type="hidden" name="questionnaire_id" value="{{ selected_questionnaire.id }}">

                <div class="col-sm text-start mb-4">
                  <!-- choice -->
                  <div class="input-group mb-4">
                    <span class="input-group-text" style="width: 15%;">Choice</span>
                    <input type="text" class="form-control" name="choice" value="{{ choice.content }}" required>
                    <span class="invalid-feedback text-start">This field is required.</span>
                  </div>
                  <!-- end choice -->
                </div>
                <!-- submit -->
                <div class="d-grid mb-4">
                  <button type="submit" class="btn btn-primary form-control-lg">Confirm</button>
                </div>
                <!-- end submit -->
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- End Edit Choice Modal -->

      <!-- Delete Choice Modal -->
      <div id="delete_modal_{{ choice.id }}" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
              <p>Click Yes to delete {{ choice.content|title }}.</p>
            </div>
            <div class="modal-footer" style="align-self: center;">
              <button type="button" class="btn btn-white" data-bs-dismiss="modal">Close</button>
              <button class="btn btn-primary" form="delete_choice_form_{{ choice.id }}">Yes</button>
            </div>
          </div>
        </div>
      </div>
      <!-- End Delete Choice Modal -->
      {% endfor %}
    </div>
  </div>
</div>
{% else %}
<div class="row">
  <div class="col mb-3 mb-lg-0">
    <div class="card">
      <!-- Header -->
      <div class="card-header card-header-content-md-between">
        <div class="mb-2 mb-md-0">
          {{ selected_question.content|capfirst }}
        </div>
      </div>
      <!-- End Header -->
      <div class="table-responsive datatable-custom">
        <table class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table">
          <tbody>
          <tr>
            <td>
              <div class="ms-3">
                {% if selected_question.next_question_token == 'stop' %}
                <span class="d-block fs-5 text-body">No next question</span>
                {% else %}
                <span class="d-block h5 text-inherit mb-0">{{ selected_question.next_question_content|capfirst }}</span>
                {% endif %}
              </div>
            </td>

            <td class="text-end">
              {% if selected_question.next_question_token == 'stop' %}
              <a type="button" class="text-body me-3" data-bs-toggle="modal" data-bs-target="#link_a_question">
                <i class="fa fa-paperclip fa-xl" data-bs-toggle="tooltip" data-bs-placement="top" title="Link a question"></i>
              </a>
              {% else %}
              <a href="{% url 'questionnaire-manager' 'selected_question_main' %}?question_token={{ selected_question.next_question_token }}&questions_page={{ questions_page }}" class="text-body me-3" >
                <i class="fa fa-arrow-pointer fa-xl" data-bs-toggle="tooltip" data-bs-placement="top" title="Select"></i>
              </a>
              {% endif %}
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- Next Question Modal -->
      <div id="link_a_question" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
              <!-- title -->
              <div class="text-center mb-7">
                <h2>Add Next Question</h2>
              </div>
              <form action="{% url 'questionnaire-manager' 'create_next_question_single' %}" class="js-validate need-validate" novalidate method="post">
                {% csrf_token %}
                <input type="hidden" name="question_token" value="{{ selected_question.token }}">

                <!-- content -->
                <div class="input-group mb-4">
                  <span class="input-group-text" style="width: 20%;">Question</span>
                  <input type="text" class="form-control" name="content" placeholder="How much? (number or packs/cigarette per day)" required>
                  <span class="invalid-feedback text-start">This field is required.</span>
                </div>
                <!-- end content -->

                <!-- type -->
                <div class="mb-6">
                  <div class="input-group input-group-hover-light">
                    <div class="input-group-prepend input-group-text" style="width: 20%;">
                      Type
                    </div>
                    <select class="form-select text-center" name="type">
                      <option value="single">Single</option>
                      <option value="choice">Choice</option>
                      <option value="multiple">Multiple</option>
                    </select>
                  </div>
                </div>
                <!-- end type -->

                <div class="d-grid mb-4">
                  <button type="submit" class="btn btn-primary form-control-lg">Confirm</button>
                </div>
                <!-- end submit -->
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- End Next Question Modal -->
    </div>
  </div>
</div>
{% endif %}
{% endblock %}

